/*! obs 0.9.1 Copyright (c) 2013 Alan Plum. MIT licensed. @preserve */
!function(t){var e=function(e){return t[e]},i={};var n=e("sublish").PubSub,r=e("aug"),u=Array.prototype.slice,o=Array.isArray?Array.isArray:function(t){return Object.prototype.toString.call(t)==="[object Array]"},c=Array.prototype.indexOf?function(t,e){return!!~t.indexOf(e)}:function(t,e){for(var i=0;i<t.length;i++){if(t[i]===e){return true}}return false};function s(t){var e=t[0];if(typeof e==="function"){e={compute:t[0]};if(t.length>1){if(typeof t[1]==="function"){e.write=t[1];if(t.length>2){e.watch=t[2]}}else{e.watch=t[1]}}}return e}function a(t){function e(t){if(arguments.length){if(typeof e.write==="function"){e.write.call(e.context,t)}else{throw new Error("This observable cannot be written to!")}}else{if(typeof e.read==="function"){return e.read.call(e.context)}else{throw new Error("This observable cannot be read from!")}}}r(e,n.prototype,{context:t.context||e,read:t.read,write:t.write,onNotify:function(t){return function(){t.call(e)}}(t.onNotify||function(){}),_initialValue:t.value,_currentValue:t.value,_previousValue:undefined,_subscriptions:[]},a.fn);n.apply(e);if(t.watch){e.watch.apply(e,o(t.watch)?t.watch:[t.watch])}return e}a.fn={__is_obs__:true,notify:function(){this.dirty=this._currentValue===this._initialValue;this.publish(this._currentValue,this._previousValue)},peek:function(){return this._currentValue},commit:function(){this._initialValue=this._currentValue;this.dirty=false},reset:function(){this._previousValue=this._currentValue;this._currentValue=this._initialValue;this.notify()},watch:function(){var t=u.call(arguments,0),e,i;for(i=0;i<t.length;i++){e=t[i];if(c(this._subscriptions,e)){continue}if(e&&typeof e.subscribe==="function"){e.subscribe(this.onNotify);this._subscriptions.push(e)}}return this},unwatch:function(){var t=u.call(arguments,0),e=this._subscriptions,i,n;for(i=0;i<t.length;i++){n=t[i];if(n&&typeof n.unsubscribe==="function"){n.unsubscribe(this.onNotify)}}this._subscriptions=[];for(i=0;i<e.length;i++){n=e[i];if(!c(t,n)){this._subscriptions.push(n)}}return this},dismiss:function(){this.unwatch.apply(this,this._subscriptions)}};a.prop=function(t){return a({read:function(){return this._currentValue},write:function(t){this._previousValue=this._currentValue;this._currentValue=t;this.notify()},value:t})};a.computed=function(t){t=s(arguments);var e=a(r({},t,{read:function(){return e._currentValue},onNotify:function(){this._previousValue=this._currentValue;this._currentValue=t.compute.call(this.context);this.notify()}}));if(t.compute){e._initialValue=t.compute.call(e.context);e._currentValue=e._initialValue}if(t.watch){e.watch.apply(e,o(t.watch)?t.watch:[t.watch])}return e};a.computed.lazy=function(t){t=s(arguments);var e=true;var i=a(r({},t,{context:t.context,read:function(){if(e){e=false;i._previousValue=i._currentValue;i._currentValue=t.compute.call(this);i.notify()}return i._currentValue},write:t.write,onNotify:function(){e=true},watch:t.watch}));return i};i.exports=a;t.obs=i.exports}(this);