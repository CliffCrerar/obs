/*! obs 0.7.0 Copyright (c) 2013 Alan Plum. MIT licensed. */(function(e){function a(){function t(){if(!arguments.length)return t._previousValue=t._currentValue,e&&(t._currentValue=t.read.call(t.context),e=!1,t.notify()),t._currentValue;if(typeof t.write!="function")throw new Error("This observable is read-only!");t.write.apply(t.context,arguments)}var e=!0;return r(t,{_initialValue:undefined,_onNotify:function(){e=!0}})}function f(e,t,n){function i(){if(!arguments.length)return i._currentValue;if(typeof i.write!="function")throw new Error("This observable is read-only!");i.write.apply(i.context,arguments)}return r(i,{_initialValue:e.apply(n===undefined?i:n),_onNotify:function(){i._previousValue=i._currentValue,i._currentValue=i.read.call(i.context),i.notify()}})}function l(){function e(){if(!arguments.length)throw new Error("This observable is write-only!");e.write.apply(e.context,arguments)}return e._initialValue=undefined,e}var t=function(t){return e[t]},n=e.obs={},r=t("assimilate"),i=t("sublish").PubSub,s=Array.prototype.slice,o=Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},u=Array.prototype.indexOf?function(e,t){return!!~e.indexOf(t)}:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1};n.prop=r(function(e){function t(e){if(!arguments.length)return t._currentValue;t._previousValue=t._currentValue,t._currentValue=e,t.notify()}return r(t,i.prototype,{_initialValue:e,_currentValue:e,dirty:!1},n.prop.fn),i.apply(t),t},{readOnly:function(e){function t(){if(arguments.length)throw new Error("This observable is read-only!");return t._currentValue}return r(t,i.prototype,{_initialValue:e,_currentValue:e,dirty:!1},n.prop.fn),i.apply(t),t},fn:{__is_obs__:!0,notify:function(){this.dirty=this._currentValue===this._initialValue,this.publish(this._currentValue,this._previousValue)},peek:function(){return this._currentValue},reset:function(){this(this._initialValue)}}}),n.computed=r(function(e,t,s){var u=!1,c;arguments.length===1&&typeof e=="object"?(t=e.write,s=e.watched,u=e.lazy,c=e.context,e=e.read,s&&!o(s)&&(s=[s])):arguments.length===2&&o(t)&&(s=t,t=undefined);if(!e&&!t)throw new Error("No read function and no write function provided!");var h=e?(u?a:f)(e,t,c):l(t);return r(h,i.prototype,{_currentValue:h._initialValue,read:e,write:t,context:c===undefined?h:c,dirty:!1,_subscriptions:[]},n.computed.fn),i.apply(h),e&&o(s)&&h.watch.apply(h,s),h},{lazy:function(e,t,i){return arguments.length===1&&typeof e=="object"?n.computed(r({lazy:!0},e)):(arguments.length===2&&o(t)&&(i=t,t=undefined),n.computed({read:e,write:t,watched:i,lazy:!0}))},fn:r({},n.prop.fn,{watch:function(){var e=s.call(arguments,0),t,n;for(n=0;n<e.length;n++){t=e[n];if(u(this._subscriptions,t))continue;t&&typeof t.subscribe=="function"&&(t.subscribe(this._onNotify),this._subscriptions.push(t))}return this},unwatch:function(){var e=s.call(arguments,0),t=this._subscriptions,n,r;for(n=0;n<e.length;n++)r=e[n],r&&typeof r.unsubscribe=="function"&&r.unsubscribe(this._onNotify);this._subscriptions=[];for(n=0;n<t.length;n++)r=t[n],u(e,r)||this._subscriptions.push(r);return this},dismiss:function(){this.unwatch.apply(this,this._subscriptions)}})})})(this);