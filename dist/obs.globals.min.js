/*! obs 0.5.0 Copyright (c) 2013 Alan Plum. MIT licensed. */(function(e){function o(e,t){function i(){if(!arguments.length)return i._previousValue=i._currentValue,n&&(i._currentValue=e.apply(i),n=!1,i.notify()),i._currentValue;if(typeof t!="function")throw new Error("This observable is read-only!");t.apply(i,arguments)}var n=!0;return r(i,{_initialValue:undefined,_onNotify:function(){n=!0}})}function u(e,t){function n(){if(!arguments.length)return n._currentValue;if(typeof t!="function")throw new Error("This observable is read-only!");t.apply(n,arguments)}return r(n,{_initialValue:e.apply(n),_onNotify:function(){n._previousValue=n._currentValue,n._currentValue=e.apply(n),n.notify()}})}function a(e){function t(){if(!arguments.length)throw new Error("This observable is write-only!");e.apply(t,arguments)}return t._initialValue=undefined,t}var t=function(t){return e[t]},n=e.obs={},r=t("aug"),i=t("sublish").PubSub,s=Array.prototype;n.prop=r(function(e){function t(e){if(!arguments.length)return t._currentValue;t._previousValue=t._currentValue,t._currentValue=e,t.notify()}return r(t,i.prototype,{_initialValue:e,_currentValue:e,dirty:!1},n.prop.fn),i.apply(t),t},{fn:{__is_obs__:!0,notify:function(){this.dirty=this._currentValue===this._initialValue,this.publish(this._currentValue,this._previousValue)},peek:function(){return this._currentValue},reset:function(){this(this._initialValue)}}}),n.computed=r(function(e,t,s){var f;arguments.length===1&&typeof e=="object"?(s=e.lazy,t=e.watched,f=e.write,e=e.read):arguments.length<3&&typeof t=="boolean"&&(s=t,t=undefined);if(!e&&!f)throw new Error("No read function and no write function provided!");var l=e?(s?o:u)(e,f):a(f);return r(l,i.prototype,{_currentValue:l._initialValue,dirty:!1,_subscriptions:[]},n.computed.fn),i.apply(l),e&&t&&(Array.isArray(t)?l.watch.apply(l,t):l.watch(t)),l},{fn:r({},n.prop.fn,{watch:function(){return s.forEach.call(arguments,function(e){e&&typeof e.subscribe=="function"&&(e.subscribe(this._onNotify),this._subscriptions.push(e))}.bind(this)),this},unwatch:function(){var e=s.slice.call(arguments,0),t=this._subscriptions;return e.forEach(function(e){e&&typeof e.unsubscribe=="function"&&e.unsubscribe(this._onNotify)}.bind(this)),this._subscriptions=t.filter(function(t){return e.indexOf(t)===-1}),this},dismiss:function(){this.unwatch.apply(this,this._subscriptions)}})})})(this);