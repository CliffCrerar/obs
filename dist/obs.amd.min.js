/*! obs 0.6.1 Copyright (c) 2013 Alan Plum. MIT licensed. */define(function(e,t){function u(){function t(){if(!arguments.length)return t._previousValue=t._currentValue,e&&(t._currentValue=t.read.call(t.context),e=!1,t.notify()),t._currentValue;if(typeof t.write!="function")throw new Error("This observable is read-only!");t.write.apply(t.context,arguments)}var e=!0;return n(t,{_initialValue:undefined,_onNotify:function(){e=!0}})}function a(e,t,r){function i(){if(!arguments.length)return i._currentValue;if(typeof i.write!="function")throw new Error("This observable is read-only!");i.write.apply(i.context,arguments)}return n(i,{_initialValue:e.apply(r===undefined?i:r),_onNotify:function(){i._previousValue=i._currentValue,i._currentValue=i.read.call(i.context),i.notify()}})}function f(){function e(){if(!arguments.length)throw new Error("This observable is write-only!");e.write.apply(e.context,arguments)}return e._initialValue=undefined,e}var n=e("aug"),r=e("sublish").PubSub,i=Array.prototype.slice,s=Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},o=Array.prototype.indexOf?function(e,t){return!!~e.indexOf(t)}:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1};t.prop=n(function(e){function i(e){if(!arguments.length)return i._currentValue;i._previousValue=i._currentValue,i._currentValue=e,i.notify()}return n(i,r.prototype,{_initialValue:e,_currentValue:e,dirty:!1},t.prop.fn),r.apply(i),i},{readOnly:function(e){function i(){if(arguments.length)throw new Error("This observable is read-only!");return i._currentValue}return n(i,r.prototype,{_initialValue:e,_currentValue:e,dirty:!1},t.prop.fn),r.apply(i),i},fn:{__is_obs__:!0,notify:function(){this.dirty=this._currentValue===this._initialValue,this.publish(this._currentValue,this._previousValue)},peek:function(){return this._currentValue},reset:function(){this(this._initialValue)}}}),t.computed=n(function(e,i,o){var l=!1,c;arguments.length===1&&typeof e=="object"?(i=e.write,o=e.watched,l=e.lazy,c=e.context,e=e.read,o&&!s(o)&&(o=[o])):arguments.length===2&&s(i)&&(o=i,i=undefined);if(!e&&!i)throw new Error("No read function and no write function provided!");var h=e?(l?u:a)(e,i,c):f(i);return n(h,r.prototype,{_currentValue:h._initialValue,read:e,write:i,context:c===undefined?h:c,dirty:!1,_subscriptions:[]},t.computed.fn),r.apply(h),e&&s(o)&&h.watch.apply(h,o),h},{lazy:function(e,r,i){return arguments.length===1&&typeof e=="object"?t.computed(n({lazy:!0},e)):(arguments.length===2&&s(r)&&(i=r,r=undefined),t.computed({read:e,write:r,watched:i,lazy:!0}))},fn:n({},t.prop.fn,{watch:function(){var e=i.call(arguments,0),t,n;for(n=0;n<e.length;n++){t=e[n];if(o(this._subscriptions,t))continue;t&&typeof t.subscribe=="function"&&(t.subscribe(this._onNotify),this._subscriptions.push(t))}return this},unwatch:function(){var e=i.call(arguments,0),t=this._subscriptions,n,r;for(n=0;n<e.length;n++)r=e[n],r&&typeof r.unsubscribe=="function"&&r.unsubscribe(this._onNotify);this._subscriptions=[];for(n=0;n<t.length;n++)r=t[n],o(e,r)||this._subscriptions.push(r);return this},dismiss:function(){this.unwatch.apply(this,this._subscriptions)}})})});