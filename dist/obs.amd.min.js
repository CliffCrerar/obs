/*! obs 0.6.0 Copyright (c) 2013 Alan Plum. MIT licensed. */define(function(e,t){function o(e,t){function i(){if(!arguments.length)return i._previousValue=i._currentValue,r&&(i._currentValue=e.apply(i),r=!1,i.notify()),i._currentValue;if(typeof t!="function")throw new Error("This observable is read-only!");t.apply(i,arguments)}var r=!0;return n(i,{_initialValue:undefined,_onNotify:function(){r=!0}})}function u(e,t){function r(){if(!arguments.length)return r._currentValue;if(typeof t!="function")throw new Error("This observable is read-only!");t.apply(r,arguments)}return n(r,{_initialValue:e.apply(r),_onNotify:function(){r._previousValue=r._currentValue,r._currentValue=e.apply(r),r.notify()}})}function a(e){function t(){if(!arguments.length)throw new Error("This observable is write-only!");e.apply(t,arguments)}return t._initialValue=undefined,t}var n=e("aug"),r=e("sublish").PubSub,i=Array.prototype.slice,s=Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"};t.prop=n(function(e){function i(e){if(!arguments.length)return i._currentValue;i._previousValue=i._currentValue,i._currentValue=e,i.notify()}return n(i,r.prototype,{_initialValue:e,_currentValue:e,dirty:!1},t.prop.fn),r.apply(i),i},{readOnly:function(e){function i(){if(arguments.length)throw new Error("This observable is read-only!");return i._currentValue}return n(i,r.prototype,{_initialValue:e,_currentValue:e,dirty:!1},t.prop.fn),r.apply(i),i},fn:{__is_obs__:!0,notify:function(){this.dirty=this._currentValue===this._initialValue,this.publish(this._currentValue,this._previousValue)},peek:function(){return this._currentValue},reset:function(){this(this._initialValue)}}}),t.computed=n(function(e,i,f){var l=!1;arguments.length===1&&typeof e=="object"?(i=e.write,f=e.watched,l=e.lazy,e=e.read,f&&!s(f)&&(f=[f])):arguments.length===2&&s(i)&&(f=i,i=undefined);if(!e&&!i)throw new Error("No read function and no write function provided!");var c=e?(l?o:u)(e,i):a(i);return n(c,r.prototype,{_currentValue:c._initialValue,dirty:!1,_subscriptions:[]},t.computed.fn),r.apply(c),e&&s(f)&&c.watch.apply(c,f),c},{lazy:function(e,r,i){return arguments.length===1&&typeof e=="object"?t.computed(n({lazy:!0},e)):(arguments.length===2&&s(r)&&(i=r,r=undefined),t.computed({read:e,write:r,watched:i,lazy:!0}))},fn:n({},t.prop.fn,{watch:function(){var e=i.call(arguments,0),t,n;for(n=0;n<e.length;n++)t=e[n],t&&typeof t.subscribe=="function"&&(t.subscribe(this._onNotify),this._subscriptions.push(t));return this},unwatch:function(){var e=i.call(arguments,0),t=this._subscriptions,n,r,s;for(n=0;n<e.length;n++)s=e[n],s&&typeof s.unsubscribe=="function"&&s.unsubscribe(this._onNotify);this._subscriptions=[];for(n=0;n<t.length;n++){s=t[n];for(r=0;r<e.length;r++)if(e[r]===s){this._subscriptions.push(s);break}}return this},dismiss:function(){this.unwatch.apply(this,this._subscriptions)}})})});