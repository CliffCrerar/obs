/*! obs 0.4.0 Copyright (c) 2013 Alan Plum. MIT licensed. */function lazyComputed(e){function n(){return n._previousValue=n._currentValue,t&&(n._currentValue=e(),t=!1,n.notify()),n._currentValue}var t=!0;return aug(n,{_initialValue:undefined,_onNotify:function(){t=!0}})}function eagerComputed(e){function n(){return n._currentValue}var t=e();return aug(n,{_initialValue:t,_onNotify:function(){this._previousValue=this._currentValue,this._currentValue=e(),this.notify()}.bind(n)})}var aug=require("aug"),sublish=require("sublish");exports.prop=aug(function(e){function t(e){if(!arguments.length)return t._currentValue;typeof t.validate=="function"&&t.validate(e),t._previousValue=t._currentValue,t._currentValue=e,t.notify()}return sublish.PubSub(t),aug(t,{_initialValue:e,_currentValue:e,dirty:!1},exports.prop.fn),t},{fn:{__is_obs__:!0,notify:function(){this.dirty=this._currentValue===this._initialValue,this.publish(this._currentValue,this._previousValue)},peek:function(){return this._currentValue},dismiss:function(){},reset:function(){this(this._initialValue)}}}),exports.computed=aug(function(e,t,n){var r=(n?lazyComputed:eagerComputed)(e);return sublish.PubSub(r),aug(r,{_currentValue:r._initialValue,_dependencies:[]},exports.computed.fn),t&&(Array.isArray(t)?r.watch.apply(r,t):r.watch(t)),r},{fn:{__is_obs__:!0,notify:function(){this.dirty=this._currentValue===this._initialValue,this.publish(this._currentValue,this._previousValue)},peek:function(){return this._currentValue},watch:function(){Array.prototype.forEach.call(arguments,function(e){e&&typeof e.subscribe=="function"&&(e.subscribe(this._onNotify),this._dependencies.push(e))}.bind(this))},unwatch:function(){var e=Array.prototype.slice.call(arguments,0),t=this._dependencies;e.forEach(function(e){e&&typeof e.unsubscribe=="function"&&e.unsubscribe(this._onNotify)}.bind(this)),this._dependencies=t.filter(function(t){return e.indexOf(t)===-1})},dismiss:function(){this.unwatch.apply(this,this._dependencies)}}});