/*! obs 0.5.2 Copyright (c) 2013 Alan Plum. MIT licensed. */function lazyComputed(e,t){function r(){if(!arguments.length)return r._previousValue=r._currentValue,n&&(r._currentValue=e.apply(r),n=!1,r.notify()),r._currentValue;if(typeof t!="function")throw new Error("This observable is read-only!");t.apply(r,arguments)}var n=!0;return aug(r,{_initialValue:undefined,_onNotify:function(){n=!0}})}function eagerComputed(e,t){function n(){if(!arguments.length)return n._currentValue;if(typeof t!="function")throw new Error("This observable is read-only!");t.apply(n,arguments)}return aug(n,{_initialValue:e.apply(n),_onNotify:function(){n._previousValue=n._currentValue,n._currentValue=e.apply(n),n.notify()}})}function writeOnlyComputed(e){function t(){if(!arguments.length)throw new Error("This observable is write-only!");e.apply(t,arguments)}return t._initialValue=undefined,t}var aug=require("aug"),PubSub=require("sublish").PubSub,slice=Array.prototype.slice;exports.prop=aug(function(e){function t(e){if(!arguments.length)return t._currentValue;t._previousValue=t._currentValue,t._currentValue=e,t.notify()}return aug(t,PubSub.prototype,{_initialValue:e,_currentValue:e,dirty:!1},exports.prop.fn),PubSub.apply(t),t},{fn:{__is_obs__:!0,notify:function(){this.dirty=this._currentValue===this._initialValue,this.publish(this._currentValue,this._previousValue)},peek:function(){return this._currentValue},reset:function(){this(this._initialValue)}}}),exports.computed=aug(function(e,t,n){var r;arguments.length===1&&typeof e=="object"?(n=e.lazy,t=e.watched,r=e.write,e=e.read):arguments.length<3&&typeof t=="boolean"&&(n=t,t=undefined);if(!e&&!r)throw new Error("No read function and no write function provided!");var i=e?(n?lazyComputed:eagerComputed)(e,r):writeOnlyComputed(r);return aug(i,PubSub.prototype,{_currentValue:i._initialValue,dirty:!1,_subscriptions:[]},exports.computed.fn),PubSub.apply(i),e&&t&&(Object.prototype.toString.call(t)==="[object Array]"?i.watch.apply(i,t):i.watch(t)),i},{fn:aug({},exports.prop.fn,{watch:function(){var e=slice.call(arguments,0),t,n;for(n=0;n<e.length;n++)t=e[n],t&&typeof t.subscribe=="function"&&(t.subscribe(this._onNotify),this._subscriptions.push(t));return this},unwatch:function(){var e=slice.call(arguments,0),t=this._subscriptions,n,r;for(n=0;n<e.length;n++)r=e[n],r&&typeof r.unsubscribe=="function"&&r.unsubscribe(this._onNotify);this._subscriptions=[];for(n=0;n<t.length;n++)r=t[n],e.indexOf(r)===-1&&this._subscriptions.push(r);return this},dismiss:function(){this.unwatch.apply(this,this._subscriptions)}})});