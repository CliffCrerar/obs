/*! assimilate 0.2.0 Copyright (c) 2013 Alan Plum. MIT licensed. */function assimilateWithStrategy(e,t,n){var r=slice.call(arguments,3),i,s,o;if(n===undefined||n===null)n={};for(i=0;i<r.length;i++){s=r[i];if(s===undefined||s===null)continue;for(o in s)(t||s.hasOwnProperty(o))&&e(n,s,o,t)}return n}function assimilate(){var e=slice.call(arguments,0);return assimilateWithStrategy.apply(this,[assimilate.strategies.DEFAULT,!1].concat(e))}var slice=Array.prototype.slice;assimilate.withStrategy=function(e,t){arguments.length===1&&typeof e=="boolean"&&(t=e,e="default"),typeof e=="string"&&(e=e.toUpperCase(),typeof assimilate.strategies[e]=="function"&&(e=assimilate.strategies[e]));if(typeof e!="function")throw new Error("Unknown strategy or not a function: "+e);return function(){var n=slice.call(arguments,0);return assimilateWithStrategy.apply(this,[e,!!t].concat(n))}},assimilate.strategies={DEFAULT:function(e,t,n){e[n]=t[n]},DEEP:function(e,t,n,r){var i=t[n],s=e[n];e.hasOwnProperty(n)&&typeof i=="object"&&typeof s=="object"?assimilateWithStrategy(assimilate.strategies.DEEP,r,s,i):e[n]=i},STRICT:function(e,t,n){var r=t[n];r!==undefined&&(e[n]=r)},FALLBACK:function(e,t,n){var r=e[n];r===undefined&&(e[n]=t[n])}},module.exports=assimilate,function(e){function r(){this._subscribers=[]}var t=function(t){return e[t]},n=e.sublish={};r.prototype={subscribe:function(e){this._subscribers.push(e)},unsubscribe:function(e){for(var t=0;t<this._subscribers.length;t++)if(this._subscribers[t]===e)return this._subscribers.splice(t,1),!0;return!1},publish:function(){var e=Array.prototype.slice.call(arguments,0);for(var t=0;t<this._subscribers.length;t++)this._subscribers[t].apply(this,e)}},n.PubSub=r}(this),function(e){function a(e){var t=e[0];return typeof t=="function"&&(t={compute:e[0]},e.length>1&&(typeof e[1]=="function"?(t.write=e[1],e.length>2&&(t.watch=e[2])):t.watch=e[1])),t}function f(e){function t(e){if(!arguments.length){if(typeof t.read=="function")return t.read.call(t.context);throw new Error("This observable cannot be read from!")}if(typeof t.write!="function")throw new Error("This observable cannot be written to!");t.write.call(t.context,e)}return r(t,i.prototype,{context:e.context||t,read:e.read,write:e.write,onNotify:function(e){return function(){e.call(t)}}(e.onNotify||function(){}),_initialValue:e.value,_currentValue:e.value,_previousValue:undefined,_subscriptions:[]},f.fn),i.apply(t),e.watch&&t.watch.apply(t,o(e.watch)?e.watch:[e.watch]),t}var t=function(t){return e[t]},n=e.obs={},r=t("assimilate"),i=t("sublish").PubSub,s=Array.prototype.slice,o=Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},u=Array.prototype.indexOf?function(e,t){return!!~e.indexOf(t)}:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1};f.fn={__is_obs__:!0,notify:function(){this.dirty=this._currentValue===this._initialValue,this.publish(this._currentValue,this._previousValue)},peek:function(){return this._currentValue},commit:function(){this._initialValue=this._currentValue,this.dirty=!1},reset:function(){this._previousValue=this._currentValue,this._currentValue=this._initialValue,this.notify()},watch:function(){var e=s.call(arguments,0),t,n;for(n=0;n<e.length;n++){t=e[n];if(u(this._subscriptions,t))continue;t&&typeof t.subscribe=="function"&&(t.subscribe(this.onNotify),this._subscriptions.push(t))}return this},unwatch:function(){var e=s.call(arguments,0),t=this._subscriptions,n,r;for(n=0;n<e.length;n++)r=e[n],r&&typeof r.unsubscribe=="function"&&r.unsubscribe(this.onNotify);this._subscriptions=[];for(n=0;n<t.length;n++)r=t[n],u(e,r)||this._subscriptions.push(r);return this},dismiss:function(){this.unwatch.apply(this,this._subscriptions)}},f.prop=function(e){return f({read:function(){return this._currentValue},write:function(e){this._previousValue=this._currentValue,this._currentValue=e,this.notify()},value:e})},f.computed=function(e){e=a(arguments);var t=f(r({},e,{read:function(){return t._currentValue},onNotify:function(){this._previousValue=this._currentValue,this._currentValue=e.compute.call(this.context),this.notify()}}));return e.compute&&(t._initialValue=e.compute.call(t.context),t._currentValue=t._initialValue),e.watch&&t.watch.apply(t,o(e.watch)?e.watch:[e.watch]),t},f.computed.lazy=function(e){e=a(arguments);var t=!0,n=f(r({},e,{context:e.context,read:function(){return t&&(t=!1,n._previousValue=n._currentValue,n._currentValue=e.compute.call(this),n.notify()),n._currentValue},write:e.write,onNotify:function(){t=!0},watch:e.watch}));return n},module.exports=f}(this);