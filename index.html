<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>obs by pluma</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>obs</h1>
        <p>Observable properties done right.</p>
        <p class="view"><a href="https://github.com/pluma/obs">View the Project on GitHub <small>pluma/obs</small></a></p>
        <ul>
          <li><a href="https://github.com/pluma/obs/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/pluma/obs/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/pluma/obs">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Synopsis</h1>

<p><strong>obs</strong> is a powerful implementation of observable properties that can be used on both the client-side and the server-side.</p>

<p>Together with <a href="http://rivetsjs.com">rivets.js</a> it can serve as a lightweight alternative to <a href="http://knockoutjs.com">Knockout.js</a>.</p>

<p><a href="https://ci.testling.com/pluma/obs"><img src="https://ci.testling.com/pluma/obs.png" alt="browser support"></a></p>

<p><a href="https://travis-ci.org/pluma/obs"><img src="https://travis-ci.org/pluma/obs.png?branch=master" alt="Build Status"></a></p>

<h1>Install</h1>

<h2>Node.js</h2>

<h3>With NPM</h3>

<div class="highlight"><pre>npm install obs
</pre></div>

<h3>From source</h3>

<div class="highlight"><pre>git clone https://github.com/pluma/obs.git
<span class="nb">cd </span>obs
npm install
make <span class="o">&amp;&amp;</span> make dist
</pre></div>

<h2>Browser</h2>

<h3>With component</h3>

<div class="highlight"><pre>component install pluma/obs
</pre></div>

<p><a href="https://github.com/component/component">Learn more about component</a>.</p>

<h3>With a CommonJS module loader</h3>

<p>Download the <a href="https://raw.github.com/pluma/obs/master/dist/obs.min.js">latest minified CommonJS release</a> and add it to your project.</p>

<p>Make sure you also have a compatible copy of <a href="https://github.com/pluma/assimilate">assimilate</a> and <a href="https://github.com/pluma/sublish">sublish</a>.</p>

<p><a href="http://wiki.commonjs.org/wiki/Modules/1.1">Learn more about CommonJS modules</a>.</p>

<h3>With an AMD module loader</h3>

<p>Download the <a href="https://raw.github.com/pluma/obs/master/dist/obs.amd.min.js">latest minified AMD release</a> and add it to your project.</p>

<p>Make sure you also have a compatible copy of <a href="https://github.com/pluma/assimilate">assimilate</a> and <a href="https://github.com/pluma/sublish">sublish</a>.</p>

<p><a href="http://requirejs.org/docs/whyamd.html">Learn more about AMD modules</a>.</p>

<h3>As standalone bundle</h3>

<p>Get the <a href="https://raw.github.com/pluma/obs/master/dist/obs.all.min.js">latest distribution bundle</a> (~4.1 kB or ~1.4 kB gzipped, includes <a href="https://github.com/pluma/assimilate/tree/0.1.0">assimilate 0.1.0</a> and <a href="https://github.com/pluma/sublish/tree/0.3.0">sublish 0.4.2</a>) and download it to your project.</p>

<div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/your/js/path/obs.all.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>This makes the <code>obs</code> module available in the global namespace.</p>

<p>If you are already using <code>assimilate</code> and <code>sublish</code> in your project, you can download the <a href="https://raw.github.com/pluma/obs/master/dist/obs.globals.min.js">latest minified standalone release</a> (~3.2 kB or ~1.1 kB minified) instead.</p>

<h1>Basic usage example with node.js</h1>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">obs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'obs'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">obs</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="nx">y</span> <span class="o">=</span> <span class="nx">obs</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="nx">sum</span> <span class="o">=</span> <span class="nx">obs</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">()</span> <span class="o">+</span> <span class="nx">y</span><span class="p">();</span>
    <span class="p">},</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]),</span>
    <span class="nx">product</span> <span class="o">=</span> <span class="nx">obs</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">()</span> <span class="o">*</span> <span class="nx">y</span><span class="p">();</span>
    <span class="p">},</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'sum is currently '</span> <span class="o">+</span> <span class="nx">sum</span><span class="p">());</span>
<span class="c1">// 'sum is currently 7'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'product is currently '</span> <span class="o">+</span> <span class="nx">product</span><span class="p">());</span>
<span class="c1">// 'product is currently 10'</span>

<span class="nx">sum</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">old</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'sum is now '</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s1">' (was: '</span> <span class="o">+</span> <span class="nx">old</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">product</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">old</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'product is now '</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s1">' (was: '</span> <span class="o">+</span> <span class="nx">old</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">x</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="c1">// 'sum is now 8 (was: 7)'</span>
<span class="c1">// 'product is now 15 (was: 10)'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'sum is currently '</span> <span class="o">+</span> <span class="nx">sum</span><span class="p">());</span>
<span class="c1">// 'sum is currently 8'</span>
<span class="nx">y</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="c1">// 'sum is now 11 (was: 8)'</span>
<span class="c1">// 'product is now 24 (was: 15)'</span>
</pre></div>

<h1>Client-side example with <a href="http://rivetsjs.com">rivets.js</a> data-binding</h1>

<p>Try it on <a href="http://jsfiddle.net/QdLxc/3/">jsfiddle</a>.</p>

<h2>HTML</h2>

<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"view"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>
        Your name:
        <span class="nt">&lt;input</span> <span class="na">data-rv-value=</span><span class="s">"user.name"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">data-rv-bgcolor=</span><span class="s">"color"</span><span class="nt">&gt;</span>
        Hello <span class="nt">&lt;span</span> <span class="na">data-rv-text=</span><span class="s">"user.name"</span><span class="nt">&gt;&lt;/span&gt;</span>!<span class="nt">&lt;br&gt;</span>
        The current UNIX time is: <span class="nt">&lt;span</span> <span class="na">data-rv-text=</span><span class="s">"now"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h2>CSS</h2>

<div class="highlight"><pre><span class="nf">#view</span> <span class="p">{</span>
    <span class="k">font</span><span class="o">:</span> <span class="m">16px</span> <span class="n">Verdana</span><span class="o">,</span> <span class="n">Arial</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#view</span> <span class="nt">div</span> <span class="p">{</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h2>JavaScript</h2>

<h3>Utilities</h3>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'rgba(255,0,0,0.5)'</span><span class="p">,</span> <span class="s1">'rgba(255,255,0,0.5)'</span><span class="p">,</span>
    <span class="s1">'rgba(0,255,0,0.5)'</span><span class="p">,</span> <span class="s1">'rgba(0,255,255,0.5)'</span><span class="p">,</span>
    <span class="s1">'rgba(0,0,255,0.5)'</span><span class="p">,</span> <span class="s1">'rgba(255,0,255,0.5)'</span>
<span class="p">];</span>
<span class="kd">function</span> <span class="nx">resolveKeypath</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">keypath</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h3>Rivets.js adapter and configuration</h3>

<div class="highlight"><pre><span class="nx">rivets</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span>
    <span class="nx">prefix</span><span class="o">:</span> <span class="s1">'rv'</span><span class="p">,</span>
    <span class="nx">adapter</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">resolveKeypath</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">unsubscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">resolveKeypath</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">).</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">read</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">resolveKeypath</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">)();</span>
        <span class="p">},</span>
        <span class="nx">publish</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">resolveKeypath</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">)(</span><span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">rivets</span><span class="p">.</span><span class="nx">binders</span><span class="p">.</span><span class="nx">bgcolor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>

<h3>ViewModel (using obs.js)</h3>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">viewModel</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">now</span><span class="o">:</span> <span class="nx">obs</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()),</span>
    <span class="nx">color</span><span class="o">:</span> <span class="nx">obs</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="nx">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="nx">obs</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="s1">'User'</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">rivets</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#view'</span><span class="p">),</span> <span class="nx">viewModel</span><span class="p">);</span>

<span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">viewModel</span><span class="p">.</span><span class="nx">now</span><span class="p">(</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
    <span class="nx">viewModel</span><span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="nx">colors</span><span class="p">[</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="p">]);</span>
<span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
</pre></div>

<h1>API</h1>

<h2>prop: Observable properties</h2>

<h3>prop([initialValue])</h3>

<p>Creates an observable property (optionally initialised with the given value).</p>

<h3>prop#()</h3>

<p>Returns the property's current value.</p>

<h3>prop#(newValue)</h3>

<p>Sets the property's value to <code>newValue</code>. Notifies all subscribers with the new and old value.</p>

<h3>prop#subscribe(callback:Function)</h3>

<p>Adds the given callback function to this property's list of subscribers.</p>

<p>The callback will be called with the property's new and old value as its arguments whenever the property is set to a new value (even if the new value is equal to the old value).</p>

<h3>prop#unsubscribe(callback:Function):Boolean</h3>

<p>Removes the given callback function from this property's list of subscribers. The callback will no longer be called when the property's value changes.</p>

<p>Returns <code>false</code> if the callback could not be found in the list of subscribers or <code>true</code> otherwise.</p>

<p><strong>NOTE:</strong> Remember to use the exact function that was passed to <code>prop#subscribe</code>.</p>

<h3>prop#peek()</h3>

<p>Returns the property's current value. This method mainly exists for compatibility reasons.</p>

<h3>prop#reset()</h3>

<p>Resets the property to its initial value (or <code>undefined</code>).</p>

<h3>prop.readOnly([initialValue])</h3>

<p>Creates an observable property that can not be written to directly.</p>

<h3>prop.fn</h3>

<p>An object containing attributes that will be applied to new observable properties.</p>

<h2>computed: Computed observables</h2>

<h3>computed(readFn:Function, [writeFn:Function], [watched:Array])</h3>

<p>Creates a computed observable property. The property's value will be set to the return value of the given function <code>readFn</code> and updated whenever any of the <code>watched</code> functions changes.</p>

<p>If a <code>writeFn</code> is passed, that function will be used when the computed observable is passed a value.</p>

<p>The list of <code>watched</code> functions can be an array containing any kind of object that supports the <code>subscribe</code> and (optionally) <code>unsubscribe</code> methods (e.g. an instance of <code>sublish.PubSub</code>).</p>

<h3>computed(options)</h3>

<p>Creates a computed observable property with the given options.</p>

<h4>options.read:Function (optional)</h4>

<p>The function this computed observable will use to generate its value. If this option is not provided, the observable will be write-only.</p>

<p><strong>NOTE</strong>: This option is only optional if a <code>write</code> function is provided.</p>

<h4>options.write:Function (optional)</h4>

<p>The function this computed observable will use when it is passed a value. If this option is not provided, the observable will be read-only.</p>

<p><strong>NOTE</strong>: This option is only optional if a <code>read</code> function is provided.</p>

<h4>options.lazy:Boolean (optional)</h4>

<p>If <code>lazy</code> is set to <code>true</code> (default: <code>false</code>), updating of the property's new value will be delayed until the first time the property is called. This also means subscribers will not be notified until the property is called directly. This option has no effect if no <code>read</code> function is provided.</p>

<h4>options.watched:Array (optional)</h4>

<p>See above. This option has no effect if no <code>read</code> function is provided. If a single object is passed instead of an array, the object will automatically be wrapped in an array.</p>

<h4>options.context (optional)</h4>

<p>The context the <code>read</code> and <code>write</code> functions will be executed in. Defaults to the computed observable itself.</p>

<h3>computed#()</h3>

<p>Returns the computed property's current value. For lazy computed observables, this will trigger the function evaluation and notify any subscribers.</p>

<h3>computed#subscribe(callback:Function)</h3>

<p>Adds the given callback function to this property's list of subscribers. See <code>prop#subscribe</code>.</p>

<h3>computed#unsubscribe(callback:Function)</h3>

<p>Removes the given callback function from this property#s list of subscribers. See <code>prop#unsubscribe</code>.</p>

<h3>computed#peek()</h3>

<p>Returns the computed property's current value. Unlike <code>computed#()</code> this will not trigger the function evaluation in lazy computed observables.</p>

<h3>computed#watch(dependencies…)</h3>

<p>Adds the given objects as dependencies. The passed objects should support the <code>subscribe</code> method and optionally support the <code>unsubscribe</code> method. Duplicates will be ignored.</p>

<h3>computed#unwatch(dependencies…)</h3>

<p>Removes the given objects from the computed property's dependencies after calling their <code>unsubscribe</code> methods, if possible.</p>

<h3>computed#dismiss()</h3>

<p>Removes all of the computed property's dependencies. Equivalent to calling <code>computed#unwatch</code> for each dependency.</p>

<h3>computed#reset()</h3>

<p>See <code>prop#reset()</code>. This method will fail if the computed observable property is not writable.</p>

<h3>computed#read</h3>

<p>The function that will be called when the computed observable is read.</p>

<h3>computed#write</h3>

<p>The function that will be called when the computed observable is written to.</p>

<h3>computed.lazy(readFn:Function, [writeFn: Function], [watched:Array])</h3>

<p>See <code>computed(…)</code>. Shorthand for creating a computed observable with <code>lazy</code> set to <code>True</code>.</p>

<h3>computed.lazy(options)</h3>

<p>See <code>computed(options)</code>. Shorthand for creating a computed observable with <code>lazy</code> set to <code>True</code>.</p>

<h3>computed.fn</h3>

<p>An object containing attributes that will be applied to new computed observable properties.</p>

<h1>Acknowledgements</h1>

<p>This library was heavily inspired by <a href="https://github.com/SteveSanderson/knockout">Steve Sanderson's knockout.js project</a>.</p>

<h1>License</h1>

<p>The MIT/Expat license.</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/pluma">pluma</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>